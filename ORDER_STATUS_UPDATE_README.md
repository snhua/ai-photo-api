# è®¢å•çŠ¶æ€æ›´æ–°è¯´æ˜

## æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°ä¸ºè®¢å•è¡¨æ·»åŠ äº†æ–°çš„çŠ¶æ€å€¼ `paid` å’Œ `confirmed`ï¼š

- `paid`ï¼šè¡¨ç¤ºç”¨æˆ·ä»˜æ¬¾å®Œæˆï¼Œç”»å¸ˆå¯ä»¥æ¥å•
- `confirmed`ï¼šè¡¨ç¤ºç”¨æˆ·å·²ç¡®è®¤æ”¶è´§

## æ›´æ–°å†…å®¹

### 1. æ•°æ®åº“æ›´æ–°

- åœ¨ `orders` è¡¨çš„ `status` å­—æ®µä¸­æ·»åŠ  `paid` å’Œ `confirmed` çŠ¶æ€å€¼
- æ–°çš„çŠ¶æ€æšä¸¾ï¼š`('pending', 'paid', 'accepted', 'in_progress', 'completed', 'confirmed', 'cancelled')`

### 2. åç«¯ä»£ç æ›´æ–°

- æ›´æ–°äº† `Order` å®ä½“ç±»çš„æ³¨é‡Š
- ä¿®æ”¹äº† `OrderServiceImpl.confirmOrder()` æ–¹æ³•ï¼Œç°åœ¨ä¼šå°†è®¢å•çŠ¶æ€æ›´æ–°ä¸º `confirmed`
- æ›´æ–°äº† `OrderStatistics` ç±»ï¼Œæ·»åŠ äº† `paid` å’Œ `confirmed` çŠ¶æ€çš„ç»Ÿè®¡
- æ›´æ–°äº†è®¢å•ç»Ÿè®¡æ–¹æ³•ï¼ŒåŒ…å« `paid` å’Œ `confirmed` çŠ¶æ€çš„ç»Ÿè®¡
- æ›´æ–°äº† `getAvailableOrders()` æ–¹æ³•ï¼Œç°åœ¨æŸ¥è¯¢ `paid` çŠ¶æ€çš„è®¢å•ä¾›ç”»å¸ˆæ¥å•

### 3. å‰ç«¯ä»£ç æ›´æ–°

- æ›´æ–°äº†è®¢å•è¯¦æƒ…é¡µé¢çš„çŠ¶æ€æ˜¾ç¤º
- æ›´æ–°äº†è®¢å•åˆ—è¡¨é¡µé¢çš„çŠ¶æ€æ˜¾ç¤º
- æ›´æ–°äº†è®¢å•çŠ¶æ€æ ‡ç­¾ç»„ä»¶
- æ·»åŠ äº† `paid` å’Œ `confirmed` çŠ¶æ€çš„æ ·å¼å’Œå›¾æ ‡
- æ›´æ–°äº†è®¢å•è¿›åº¦æ­¥éª¤ï¼Œæ·»åŠ äº†ç”»å¸ˆæ¥å•æ­¥éª¤
- æ›´æ–°äº†æ“ä½œæŒ‰é’®çš„æ˜¾ç¤ºé€»è¾‘

## æ‰§è¡Œæ­¥éª¤

### 1. å¤‡ä»½æ•°æ®åº“

```bash
mysqldump -u root -p aiphone > aiphone_backup_$(date +%Y%m%d_%H%M%S).sql
```

### 2. æ‰§è¡Œæ•°æ®åº“æ›´æ–°

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
./api/update_order_status.sh

# æ–¹æ³•2ï¼šæ‰‹åŠ¨æ‰§è¡ŒSQL
mysql -u root -p aiphone < api/order_status_update.sql
```

### 3. é‡å¯åç«¯æœåŠ¡

```bash
cd api
./stop.sh
./run.sh
```

### 4. é‡æ–°ç¼–è¯‘å‰ç«¯

```bash
cd aiphone-app
npm run build
```

## çŠ¶æ€è¯´æ˜

| çŠ¶æ€å€¼      | ä¸­æ–‡åç§°   | è¯´æ˜                     |
| ----------- | ---------- | ------------------------ |
| pending     | å¾…æ”¯ä»˜     | è®¢å•å·²åˆ›å»ºï¼Œç­‰å¾…ç”¨æˆ·æ”¯ä»˜ |
| paid        | å·²æ”¯ä»˜     | ç”¨æˆ·ä»˜æ¬¾å®Œæˆï¼Œç”»å¸ˆå¯æ¥å• |
| accepted    | å·²æ¥å•     | ç”»å¸ˆå·²æ¥å—è®¢å•           |
| in_progress | åˆ¶ä½œä¸­     | ç”»å¸ˆæ­£åœ¨åˆ¶ä½œä½œå“         |
| completed   | å·²å®Œæˆ     | ç”»å¸ˆå·²å®Œæˆä½œå“æäº¤       |
| confirmed   | å·²ç¡®è®¤æ”¶è´§ | ç”¨æˆ·å·²ç¡®è®¤æ”¶è´§           |
| cancelled   | å·²å–æ¶ˆ     | è®¢å•å·²å–æ¶ˆ               |

## æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½é‡è¦**ï¼šæ‰§è¡Œæ•°æ®åº“æ›´æ–°å‰è¯·åŠ¡å¿…å¤‡ä»½æ•°æ®åº“
2. **æµ‹è¯•éªŒè¯**ï¼šæ›´æ–°åè¯·æµ‹è¯•ç¡®è®¤æ”¶è´§åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
3. **å…¼å®¹æ€§**ï¼šç°æœ‰è®¢å•çš„çŠ¶æ€ä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰æ–°ç¡®è®¤çš„è®¢å•ä¼šä½¿ç”¨ `confirmed` çŠ¶æ€

## éªŒè¯æ–¹æ³•

1. æ£€æŸ¥æ•°æ®åº“ä¸­çš„çŠ¶æ€æšä¸¾ï¼š

```sql
SHOW COLUMNS FROM orders LIKE 'status';
```

2. æµ‹è¯•æ”¯ä»˜å’Œç¡®è®¤æ”¶è´§åŠŸèƒ½ï¼š

   - åˆ›å»ºä¸€ä¸ªæµ‹è¯•è®¢å•
   - å°†è®¢å•çŠ¶æ€è®¾ç½®ä¸º `pending`
   - æ¨¡æ‹Ÿæ”¯ä»˜ï¼Œå°†çŠ¶æ€è®¾ç½®ä¸º `paid`
   - éªŒè¯ç”»å¸ˆå¯ä»¥æ¥å•
   - å°†è®¢å•çŠ¶æ€è®¾ç½®ä¸º `completed`
   - ç‚¹å‡»ç¡®è®¤æ”¶è´§æŒ‰é’®
   - éªŒè¯è®¢å•çŠ¶æ€æ˜¯å¦å˜ä¸º `confirmed`

3. æ£€æŸ¥å‰ç«¯æ˜¾ç¤ºï¼š
   - æ”¯ä»˜åï¼Œè®¢å•çŠ¶æ€åº”æ˜¾ç¤ºä¸º"å·²æ”¯ä»˜"
   - çŠ¶æ€å›¾æ ‡åº”æ˜¾ç¤ºä¸º ğŸ’°
   - ç¡®è®¤æ”¶è´§åï¼Œè®¢å•çŠ¶æ€åº”æ˜¾ç¤ºä¸º"å·²ç¡®è®¤æ”¶è´§"
   - çŠ¶æ€å›¾æ ‡åº”æ˜¾ç¤ºä¸º ğŸ‰
   - è®¢å•è¿›åº¦åº”æ˜¾ç¤ºæ‰€æœ‰æ­¥éª¤çš„å®ŒæˆçŠ¶æ€
